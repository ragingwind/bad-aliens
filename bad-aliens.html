<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Bad Aliens - Google I/O 2011 HTML5 Games Example By My Hand</title>

    <script type="text/javascript">
    // bad aliens resource file. if you need credit or resource and more info?
    // please visit to [sethladd/Bad-Aliens Â· GitHub]( http://goo.gl/qxjlL )
    var R = {
      earth: 'https://raw.github.com/sethladd/Bad-Aliens/master/static/img/earth.png',
      smalllas: 'http://www.freesound.org/data/previews/18/18397_71614-lq.mp3',
      rocketexpl: 'http://www.freesound.org/data/previews/47/47252_364925-lq.mp3',
      usat_bomb: 'http://www.freesound.org/data/previews/35/35643_14771-lq.mp3'
    };

    function AssetManager() {
      this.successCount = 0;
      this.errorCount = 0;
      this.cache = {};
      this.downloadQueue = [];
    }

    AssetManager.prototype.queueDownload = function(path) {
      this.downloadQueue.push(path);
    }

    AssetManager.prototype.isDone = function() {
      return (this.downloadQueue.length == this.successCount + this.errorCount);
    }

    AssetManager.prototype.downloadAll = function(callback) {
      for (var i = 0; i < this.downloadQueue.length; i++) {
        var path = this.downloadQueue[i];
        var img = new Image();
        var that = this;

        img.addEventListener("load", function() {
          that.successCount += 1;
          if (that.isDone()) {callback();}
        });

        img.addEventListener("error", function() {
          that.errorCount += 1;
          if (that.isDone()) {callback();}
        });

        img.src = path;
        this.cache[path] = img;
      }
    };

    AssetManager.prototype.getAsset = function(path) {
      return this.cache[path];
    }

  </script>
  </head>
  <body>
    <canvas id="surface" width="1024" height="768" style="background:black"></canvas>
  </body>
</html>

<script type="text/javascript">
  var canvas = document.getElementById('surface');
  var ctx = canvas.getContext('2d');
  var ASSET_MANAGER = new AssetManager();

  ASSET_MANAGER.queueDownload(R.earth);

  ASSET_MANAGER.downloadAll(function() {
    var x = 0, y = 0;
    var sprite = ASSET_MANAGER.getAsset(R.earth);
    ctx.save();
    ctx.translate(canvas.width/2, canvas.height/2);
    ctx.drawImage(sprite, x - sprite.width/2, y - sprite.height/2);
    ctx.restore();
  });
</script>